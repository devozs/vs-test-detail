<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <script src="lib/VSS.SDK.min.js"></script>
    <style>
        body {
            background-color: white;
            color: black;
            margin: 10px;    
            font-family: "Segoe UI VSS (Regular)","-apple-system",BlinkMacSystemFont,"Segoe UI",sans-serif;
        }
    </style>
    <script type="text/javascript">
        VSS.init({ usePlatformScripts: true, usePlatformStyles: true });
        VSS.ready(function() {
            let extensionContext = VSS.getConfiguration();
            document.getElementById("result-id").innerText = extensionContext.resultId;
            document.getElementById("run-id").innerText = extensionContext.runId;

            VSS.require(["VSS/Service", "TFS/TestManagement/RestClient"], function (VSS_Service, TFS_Test_WebApi) {
                var testClient = VSS_Service.getCollectionClient(TFS_Test_WebApi.TestHttpClient5_2);
                testClient.getTestRunById(extensionContext.viewContext.data.mainData.project.id, extensionContext.runId).then(
                    function(run) {
                        console.log(run);
                    }
                );

                testClient.getTestResultById(extensionContext.viewContext.data.mainData.project.id, extensionContext.runId, extensionContext.resultId).then(
                    function(result){ 
                        console.log(result);
                    }
                );

                testClient.getTestRunAttachments(extensionContext.viewContext.data.mainData.project.id, extensionContext.runId).then(
                    function(attachments){
                        console.log(attachments);
                        for (var i=0; i<attachments.length; i++){
                            if (attachments[i].fileName.endsWith(".xml")){
                                testClient.getTestRunAttachmentContent(extensionContext.viewContext.data.mainData.project.id, extensionContext.runId, attachments[i].id).then(
                                    function(buf){
                                        parser = new DOMParser();
                                        enc = new TextDecoder();
                                        out = enc.decode(buf);
                                        var dom = parser.parseFromString(out, 'text/xml');
                                        console.log(dom);
                                    });
                            }
                        }
                    }
                );
            });

        });
    </script>
</head>
<body>        
    <h1>Result Id: <span id="result-id"></span></h1>
    <h1>Run Id: <span id="run-id"></span></h1>
</body>
</html>